@startuml 任务执行流程图
skinparam defaultFontName "PingFang SC"
skinparam dpi 300
scale 0.3

title 攻击方式选择与强化过滤 - 任务执行流程

start

partition "步骤1: 强化过滤机制" {
  :修改 RoguelikeSystem.generateChoices();
  :获取玩家已拥有的攻击类型列表;
  :在过滤候选强化时检查 attackType;
  :过滤掉未拥有攻击的专属强化;
}

partition "步骤2: 添加强化道具" {
  :在 BuffData.js 添加 ATK_NEW 强化;
  :设置稀有度为 rare;
  :效果类型为 new_attack;
}

partition "步骤3: 新攻击选择逻辑" {
  :修改 RoguelikeSystem.applyBuffEffect();
  :处理 new_attack 类型效果;
  :触发 GameScene 显示攻击选择;
  :修改 AttackSelectScene 支持过滤;
  :选择后添加到 AttackManager;
}

partition "步骤4: 条件过滤" {
  :检查玩家已拥有攻击数量;
  if (已拥有全部6种攻击?) then (是)
    :过滤掉 ATK_NEW 强化;
  else (否)
    :保留 ATK_NEW 强化;
  endif
}

partition "验证" {
  :测试强化过滤功能;
  :测试新攻击获取功能;
  :测试边界条件;
}

stop

@enduml
