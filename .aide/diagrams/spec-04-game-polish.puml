@startuml spec-04-game-polish
!theme plain
title 《御剑无双》完整游戏流程 (完善后)

|主界面|
start
:显示游戏标题;
:显示开始按钮;
:播放背景音乐;

if (点击开始?) then (是)
  :播放按钮音效;
  :淡出过渡;
else (否)
  :等待用户操作;
  detach
endif

|战斗场景|
:初始化游戏;
:显示波次提示;
:第1波开始;

repeat
  :生成敌人;

  repeat
    :玩家移动 (WASD);
    :玩家攻击 (鼠标);
    note right
      攻击特效:
      - 剑光拖尾
      - 屏幕震动
      - Hit Stop
    end note

    :玩家使用技能 (QERS);
    note right
      技能特效:
      - 粒子效果
      - 技能音效
    end note

    if (击中敌人?) then (是)
      :播放受击音效;
      :显示伤害数字;
      :敌人闪烁;
      :应用击退;
      :增加连击;

      if (敌人死亡?) then (是)
        :播放死亡音效;
        :播放死亡粒子;
        :增加击杀数;
      endif
    endif

    if (敌人攻击玩家?) then (是)
      if (有护盾?) then (否)
        :玩家受伤;
        :屏幕震动;
        :HP闪烁;

        if (玩家死亡?) then (是)
          if (有复活?) then (是)
            :复活特效;
          else (否)
            :游戏结束;
            stop
          endif
        endif
      endif
    endif

  repeat while (波次敌人未清完?) is (是)

  :波次完成;
  :播放胜利音效;

  |强化选择|
  :暂停游戏;
  :显示3个强化选项;
  :动画展示;

  :玩家选择强化;
  :播放选择音效;
  :应用强化效果;
  :显示强化获得提示;

  |战斗场景|
  :继续游戏;
  :下一波开始;

repeat while (无限循环)

|结算界面|
:显示结算数据;
note right
  - 最高波次
  - 存活时间
  - 击杀数
  - 最高连击
  - 总伤害
  - 最终分数
end note

:播放结算音乐;
:显示排行提示;

if (点击重新开始?) then (是)
  :重置游戏;
  |主界面|
  :返回主界面;
else (否)
  stop
endif

@enduml
