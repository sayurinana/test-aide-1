# 第三章：核心玩法设计

## 3.1 操作方式

### 移动控制
| 输入方式 | 按键/操作 | 说明 |
|----------|-----------|------|
| 键盘移动 | WASD / 方向键 | 八方向移动 |
| 鼠标移动 | 右键点击 | 点击位置移动（可选） |

### 战斗控制
| 操作 | 按键 | 说明 |
|------|------|------|
| 普通攻击 | 左键 / J | 向鼠标方向攻击 |
| 技能 1 | Q / U | 范围攻击（剑气横扫） |
| 技能 2 | E / I | 突进攻击（瞬步斩） |
| 技能 3 | R / O | 防御/反击（护体真气） |
| 终极技能 | Space / K | 终极技能（剑域） |
| 闪避 | Shift / L | 快速闪避（有无敌帧） |

### 操作手感目标
- **响应迅速**：按键到动作延迟 < 50ms
- **动作流畅**：攻击动画可被移动取消
- **反馈明确**：击中有明显视觉和音效反馈

## 3.2 连击系统

### 连击计数
```
连击规则：
┌─────────────────────────────────────────┐
│ 击杀/命中敌人 → 连击 +1                 │
│ 2秒内无击中 → 连击清零                  │
│ 受到伤害 → 连击清零                     │
└─────────────────────────────────────────┘
```

### 连击奖励
| 连击数 | 奖励效果 |
|--------|----------|
| 10+ | 伤害 +5% |
| 30+ | 伤害 +10%，移速 +5% |
| 50+ | 伤害 +15%，移速 +10% |
| 100+ | 伤害 +25%，移速 +15%，攻击带溅射 |
| 200+ | 伤害 +40%，进入"无双状态" |

### 无双状态（连击 200+）
- 攻击范围扩大 50%
- 攻击速度提升 20%
- 视觉效果：角色周身环绕金色剑气
- 持续时间：直到连击中断

## 3.3 技能系统

### 技能框架
```
技能结构：
┌─────────────────────────────────────────┐
│ 技能 = {                                │
│   name: 技能名称,                       │
│   cooldown: 冷却时间(秒),               │
│   damage: 基础伤害系数,                 │
│   range: 攻击范围,                      │
│   effect: 特殊效果,                     │
│   animation: 动画数据                   │
│ }                                       │
└─────────────────────────────────────────┘
```

### 初始技能设计

#### 普通攻击：剑斩
- **描述**：向前挥剑，造成基础伤害
- **伤害**：100% ATK
- **范围**：前方扇形 60°
- **冷却**：0.3 秒（攻击间隔）
- **视觉**：青色弧形剑光

#### 技能 1：剑气横扫
- **描述**：释放环形剑气，攻击周围敌人
- **伤害**：150% ATK
- **范围**：以自身为中心，半径 150px 圆形
- **冷却**：4 秒
- **视觉**：向外扩散的青色圆环

#### 技能 2：瞬步斩
- **描述**：瞬间位移并斩击路径上的敌人
- **伤害**：200% ATK
- **范围**：直线 200px
- **冷却**：5 秒
- **特效**：位移期间无敌
- **视觉**：残影 + 直线剑光

#### 技能 3：护体真气
- **描述**：形成护盾，短暂抵挡伤害；期间受击则反弹伤害
- **效果**：格挡 1 次伤害，反弹 100% ATK
- **持续**：1.5 秒
- **冷却**：8 秒
- **视觉**：白色圆形护盾

#### 终极技能：剑域
- **描述**：展开剑气领域，持续造成范围伤害
- **伤害**：50% ATK / 0.5 秒
- **范围**：半径 200px 圆形
- **持续**：3 秒
- **冷却**：25 秒
- **视觉**：金色领域 + 飞舞的剑影

#### 闪避：御风步
- **描述**：快速闪避，期间无敌
- **距离**：100px
- **无敌时间**：0.3 秒
- **冷却**：1.5 秒
- **视觉**：半透明残影

## 3.4 攻击判定

### 碰撞检测
```
判定流程：
┌─────────────────────────────────────────┐
│ 1. 玩家发起攻击                         │
│ 2. 生成攻击判定区域（形状依技能而定）   │
│ 3. 检测区域内的敌人                     │
│ 4. 对检测到的敌人造成伤害               │
│ 5. 播放受击效果                         │
│ 6. 更新连击计数                         │
└─────────────────────────────────────────┘
```

### 判定区域类型
| 类型 | 形状 | 使用场景 |
|------|------|----------|
| 扇形 | 圆弧 | 普通攻击 |
| 圆形 | 圆 | 范围技能 |
| 矩形 | 长方形 | 突进技能 |
| 线形 | 细长矩形 | 远程攻击 |

## 3.5 伤害计算

### 基础公式
```
最终伤害 = 基础伤害 × 技能系数 × (1 + 连击加成) × (1 + 强化加成) × 暴击倍率 × 随机波动

其中：
- 基础伤害 = 角色 ATK
- 技能系数 = 技能的 damage 属性
- 连击加成 = 根据连击数查表
- 强化加成 = Roguelike 强化叠加
- 暴击倍率 = 暴击时 1.5~2.0，否则 1.0
- 随机波动 = 0.9 ~ 1.1
```

### 伤害类型
| 类型 | 颜色 | 触发条件 |
|------|------|----------|
| 普通伤害 | 白色 | 默认 |
| 暴击伤害 | 黄色 + 放大 | 触发暴击 |
| 技能伤害 | 青色 | 技能造成 |
| 真实伤害 | 金色 | 无视防御 |

---

*下一章：角色系统设计*
