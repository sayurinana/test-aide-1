# 第七章：无尽模式框架设计

## 7.1 模式概述

### 核心理念
> "镇妖塔无尽，修为无止境"

无尽模式是游戏的核心玩法。玩家在镇妖塔中不断挑战越来越强的妖魔波次，直到力竭倒下。每一次挑战都是对玩家操作和 Build 构筑能力的考验。

### 模式特点
- **永无止境**：没有固定终点，永远有下一波
- **难度递增**：每波都比上一波更难
- **记录挑战**：最高波次、最高分数成为追求目标
- **高分策略**：在生存和冒险之间寻找平衡

## 7.2 波次递进机制

### 波次结构
```
波次流程：

  准备阶段          战斗阶段          结算阶段
┌─────────┐     ┌─────────────┐    ┌──────────┐
│ 显示预告 │ ──→ │ 敌人生成    │ ──→│ 选择强化 │
│ 3秒倒计时│     │ 战斗进行    │    │ 统计显示 │
└─────────┘     │ 清空敌人    │    └──────────┘
                └─────────────┘          │
                      ↑                   │
                      └───────────────────┘
```

### 波次类型
| 类型 | 频率 | 特点 | 奖励 |
|------|------|------|------|
| **普通波** | 每波 | 标准敌人配置 | 三选一强化 |
| **精英波** | 每 3 波 | 出现精英敌人 | 额外掉落 |
| **Boss 波** | 每 5 波 | 出现 Boss | 稀有强化保底 |
| **狂潮波** | 每 10 波 | 敌人数量翻倍 | 双倍奖励 |

### 波次配置表
```javascript
const WaveConfig = {
  // 普通波
  normal: {
    duration: 'until_cleared', // 清空敌人结束
    enemyCount: wave => 10 + wave * 3,
    spawnRate: wave => 1 + wave * 0.1, // 每秒生成数
  },

  // 精英波 (波次 % 3 === 0)
  elite: {
    eliteCount: wave => Math.floor(wave / 5) + 1,
    bonusReward: true
  },

  // Boss 波 (波次 % 5 === 0)
  boss: {
    bossType: wave => getBossForWave(wave),
    guaranteedRare: true,
    minionsEnabled: true
  },

  // 狂潮波 (波次 % 10 === 0)
  swarm: {
    enemyMultiplier: 2.0,
    spawnRateMultiplier: 1.5,
    rewardMultiplier: 2.0
  }
};
```

## 7.3 难度曲线

### 难度参数缩放
```
难度公式（以波次 w 为变量）：

敌人 HP 系数   = 1 + w × 0.1 + (w/10)²× 0.05
敌人 ATK 系数  = 1 + w × 0.08
敌人数量      = 10 + w × 3 + floor(w/10) × 5
生成速率      = min(1 + w × 0.1, 5.0)  // 上限 5/秒

示例计算（波次 20）：
HP 系数  = 1 + 2 + 0.2 = 3.2
ATK 系数 = 1 + 1.6 = 2.6
敌人数量 = 10 + 60 + 10 = 80
生成速率 = 3.0/秒
```

### 难度曲线图
```
难度感知曲线：

难度
  │
  │                           ╱ 极限区
  │                         ╱
  │                    ╱──╱
  │               ╱───╱   高难区
  │          ╱───╱
  │     ╱───╱        中等区
  │╱───╱
  ╱────────          热身区
  │
  └──────────────────────────────── 波次
     1-5    6-10   11-20   21+
```

### 阶段划分
| 阶段 | 波次 | 特点 | 设计目标 |
|------|------|------|----------|
| 热身 | 1-5 | 敌人少且弱 | 熟悉操作，建立信心 |
| 发展 | 6-10 | 难度渐增 | 开始构筑 Build |
| 挑战 | 11-20 | 需要策略 | 考验 Build 质量 |
| 极限 | 21+ | 生存压力大 | 追求极限记录 |

## 7.4 里程碑奖励

### 里程碑设计
| 波次 | 名称 | 奖励 |
|------|------|------|
| 5 | 初试锋芒 | 额外一次强化选择 |
| 10 | 小有成就 | 传说强化保底 |
| 15 | 声名鹊起 | 全属性 +10% |
| 20 | 名震一方 | 解锁特殊强化池 |
| 25 | 威震八方 | HP 全恢复 + 传说强化 |
| 30 | 无双剑仙 | 获得"无双之证"称号 |
| 50 | 镇妖真人 | 进入排行榜殿堂 |

### 里程碑显示
```
达成里程碑时弹出：

┌─────────────────────────────────────────┐
│                                         │
│        ⚔️  里程碑达成  ⚔️              │
│                                         │
│           【声名鹊起】                   │
│         突破第 15 波                    │
│                                         │
│         奖励：全属性 +10%               │
│                                         │
│           [继续战斗]                    │
│                                         │
└─────────────────────────────────────────┘
```

## 7.5 结算和评分系统

### 结算触发
- 玩家 HP 归零时触发结算
- 无法中途退出保存进度

### 评分公式
```
最终分数 = 基础分 × 连击系数 × 效率系数 × 难度系数

其中：
基础分 = 击杀数 × 10 + 波次 × 1000
连击系数 = 1 + 最高连击 / 500  (上限 2.0)
效率系数 = 1 + 总伤害 / 存活时间 / 1000  (上限 1.5)
难度系数 = 1 + 最高波次 / 50  (无上限)
```

### 结算界面
```
游戏结束结算：

┌─────────────────────────────────────────┐
│                                         │
│          ☠️  修炼结束  ☠️              │
│                                         │
│         最高波次：第 18 波              │
│         存活时间：8 分 32 秒            │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│         击杀数：    847                 │
│         最高连击：  156                 │
│         造成伤害：  28,450              │
│         获得强化：  17 个               │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│         📊 最终分数：42,680             │
│         🏆 个人最高：51,230             │
│                                         │
│    [再来一局]         [返回主界面]      │
│                                         │
└─────────────────────────────────────────┘
```

### 统计数据
| 统计项 | 说明 |
|--------|------|
| 最高波次 | 本局到达的最高波次 |
| 存活时间 | 从开始到死亡的时长 |
| 击杀数 | 击杀敌人总数 |
| 最高连击 | 单次最高连击数 |
| 造成伤害 | 总伤害输出 |
| 获得强化 | 获得的强化道具数量 |
| Boss 击杀 | 击杀 Boss 数量 |

## 7.6 记录和排行

### 个人记录
```javascript
const PersonalRecords = {
  highestWave: 0,
  highestScore: 0,
  highestCombo: 0,
  totalKills: 0,
  totalPlayTime: 0,
  gamesPlayed: 0,
  achievements: []
};
```

### 成就系统（后续版本）
| 成就 | 条件 | 奖励 |
|------|------|------|
| 初入江湖 | 完成第一局游戏 | 称号 |
| 百人斩 | 单局击杀 100 敌人 | 称号 |
| 连击大师 | 达成 200 连击 | 称号 |
| 无双境界 | 到达波次 30 | 解锁皮肤 |

## 7.7 数据持久化

### 本地存储
```javascript
// 使用 localStorage 保存
const SaveData = {
  version: '1.0.0',
  records: PersonalRecords,
  settings: GameSettings,
  lastPlayed: timestamp
};

// 存储 key
const STORAGE_KEY = 'sword_immortal_save';
```

### 存储时机
- 每局游戏结束时
- 设置变更时
- 达成成就时

---

*下一章：UI/UX 设计*
