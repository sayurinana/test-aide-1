# 第五章：敌人系统设计

## 5.1 敌人分类

### 敌人层级
```
敌人金字塔：
                 ┌───────┐
                 │ Boss  │  ← 每 5/10 波出现
                 └───┬───┘
               ┌─────┴─────┐
               │   精英    │  ← 随机出现，强化属性
               └─────┬─────┘
         ┌───────────┴───────────┐
         │        小怪           │  ← 大量生成，主要击杀对象
         └───────────────────────┘
```

### 敌人类型总览
| 类型 | 代号 | 行为 | 威胁度 | 出现频率 |
|------|------|------|--------|----------|
| 飘影 | E01 | 直线追踪 | ★ | 极高 |
| 妖狼 | E02 | 快速冲锋 | ★★ | 高 |
| 蛇妖 | E03 | 远程吐息 | ★★ | 中 |
| 怨魂 | E04 | 分裂繁殖 | ★ | 中 |
| 邪修 | E05 | 释放技能 | ★★★ | 低（精英）|
| 妖将 | B01 | Boss 行为 | ★★★★★ | 特定波次 |

## 5.2 小怪设计

### E01 - 飘影（基础敌人）
```
┌─────────────────────────────────────────┐
│ 视觉：暗紫色三角形，漂浮移动           │
│                                         │
│      ▲                                  │
│     /|\  ← 尖端朝向玩家                 │
│    / | \                                │
│                                         │
│ 属性：                                   │
│   HP: 10  ATK: 5  SPD: 100              │
│                                         │
│ 行为：                                   │
│   - 持续朝玩家移动                       │
│   - 接触玩家造成伤害                     │
│   - 无特殊技能                           │
│                                         │
│ 掉落：无                                 │
└─────────────────────────────────────────┘
```

### E02 - 妖狼（冲锋敌人）
```
┌─────────────────────────────────────────┐
│ 视觉：灰色菱形，快速移动                │
│                                         │
│      ◇ ← 拉长的菱形，表现速度感         │
│                                         │
│ 属性：                                   │
│   HP: 15  ATK: 8  SPD: 180              │
│                                         │
│ 行为：                                   │
│   - 接近玩家一定距离后蓄力              │
│   - 向玩家位置冲锋                       │
│   - 冲锋期间速度翻倍                     │
│   - 冲锋后短暂硬直                       │
│                                         │
│ 掉落：小概率掉落恢复道具                │
└─────────────────────────────────────────┘
```

### E03 - 蛇妖（远程敌人）
```
┌─────────────────────────────────────────┐
│ 视觉：深绿色波浪形，远程攻击            │
│                                         │
│      ~~~  ← 波浪形表现蛇的形态          │
│                                         │
│ 属性：                                   │
│   HP: 12  ATK: 6  SPD: 80               │
│                                         │
│ 行为：                                   │
│   - 保持与玩家的距离                     │
│   - 定期发射毒息弹幕                     │
│   - 被接近时会后退                       │
│                                         │
│ 弹幕属性：                               │
│   速度: 150  伤害: 6  大小: 小圆形       │
│                                         │
│ 掉落：无                                 │
└─────────────────────────────────────────┘
```

### E04 - 怨魂（分裂敌人）
```
┌─────────────────────────────────────────┐
│ 视觉：半透明圆形，死亡时分裂            │
│                                         │
│      ○ ← 飘忽不定的圆形                 │
│                                         │
│ 属性：                                   │
│   HP: 20  ATK: 4  SPD: 120              │
│                                         │
│ 行为：                                   │
│   - 随机游走，偶尔朝玩家移动             │
│   - 死亡时分裂为 2 个小怨魂              │
│   - 小怨魂不再分裂                       │
│                                         │
│ 小怨魂属性：                             │
│   HP: 5  ATK: 2  SPD: 150               │
│                                         │
│ 掉落：无                                 │
└─────────────────────────────────────────┘
```

## 5.3 精英敌人设计

### E05 - 邪修（精英）
```
┌─────────────────────────────────────────┐
│ 视觉：暗红色人形几何，发光边缘          │
│                                         │
│       ◆                                 │
│       │                                 │
│      ─┼─  ← 类人形，有攻击动作          │
│       │                                 │
│      / \                                │
│                                         │
│ 属性：                                   │
│   HP: 80  ATK: 15  SPD: 100             │
│                                         │
│ 行为：                                   │
│   - 保持中距离战斗                       │
│   - 释放 3 种技能：                      │
│     1. 直线剑气（可闪避）                │
│     2. 范围爆炸（有预警）                │
│     3. 召唤小怪（2-3只）                 │
│                                         │
│ 掉落：必定掉落强化道具                   │
└─────────────────────────────────────────┘
```

## 5.4 Boss 设计

### B01 - 妖将（首个 Boss）
```
┌─────────────────────────────────────────┐
│ 视觉：大型黑金色复合几何体              │
│                                         │
│      ╔═══╗                              │
│      ║ ◆ ║  ← 核心（弱点）              │
│   ╔══╬═══╬══╗                           │
│   ║  ║   ║  ║  ← 多层几何组合           │
│   ╚══╩═══╩══╝                           │
│                                         │
│ 属性：                                   │
│   HP: 500  ATK: 20  SPD: 60             │
│                                         │
│ 阶段 1（HP > 50%）：                     │
│   - 横扫攻击：大范围扇形                 │
│   - 冲锋：直线冲向玩家                   │
│   - 召唤：每 15 秒召唤一波小怪           │
│                                         │
│ 阶段 2（HP ≤ 50%）：                     │
│   - 狂暴化：攻速 +50%                    │
│   - 新技能：全屏剑雨（有安全区）         │
│   - 召唤频率提升                         │
│                                         │
│ 掉落：必定掉落稀有强化                   │
└─────────────────────────────────────────┘
```

## 5.5 敌人行为 AI

### AI 状态机
```
基础敌人 AI：

    ┌──────────┐
    │   空闲   │
    └────┬─────┘
         │ 检测到玩家
         ↓
    ┌──────────┐
    │   追踪   │←──────┐
    └────┬─────┘       │
         │ 进入攻击范围│
         ↓             │
    ┌──────────┐       │
    │   攻击   │───────┘
    └──────────┘ 攻击完成
```

### 行为参数
| 参数 | 说明 | 示例值 |
|------|------|--------|
| detectRange | 检测玩家距离 | 400px |
| attackRange | 发起攻击距离 | 50px |
| attackCooldown | 攻击间隔 | 1.0s |
| retreatDistance | 保持距离（远程）| 200px |

## 5.6 敌人生成规则

### 生成机制
```
波次生成流程：
┌─────────────────────────────────────────┐
│ 1. 计算本波次敌人总数                   │
│    公式：base + wave × growth           │
│                                         │
│ 2. 确定敌人类型配比                     │
│    根据波次解锁和权重分配               │
│                                         │
│ 3. 确定生成位置                         │
│    场景边缘随机 + 最小间距              │
│                                         │
│ 4. 分批生成                             │
│    每批间隔 0.5s，避免同时出现          │
└─────────────────────────────────────────┘
```

### 波次配置示例
| 波次 | 敌人数 | 类型配比 | 特殊 |
|------|--------|----------|------|
| 1 | 10 | 飘影 100% | 教学波 |
| 2-3 | 15-20 | 飘影 80%, 妖狼 20% | |
| 4 | 25 | 飘影 60%, 妖狼 30%, 蛇妖 10% | |
| 5 | 20 + Boss | 混合 + 妖将 | Boss 波 |
| 6-9 | 30-45 | 混合 + 怨魂 | |
| 10 | 40 + Boss | 混合 + 强化妖将 | Boss 波 |

### 精英生成
- **触发条件**：波次 ≥ 5，随机概率 20%
- **最大数量**：每波最多 2 个精英
- **生成时机**：波次中期生成

## 5.7 敌人难度曲线

### 属性缩放
```
敌人属性缩放公式：

actualHP = baseHP × (1 + wave × 0.1)
actualATK = baseATK × (1 + wave × 0.08)
actualSPD = baseSPD × (1 + wave × 0.02)

示例（飘影，波次 15）：
HP: 10 × 2.5 = 25
ATK: 5 × 2.2 = 11
SPD: 100 × 1.3 = 130
```

### 难度递增方式
1. **数量增加**：更多敌人同时出现
2. **属性提升**：敌人变得更强
3. **类型丰富**：更多复杂类型出现
4. **行为升级**：攻击频率提高

---

*下一章：Roguelike 系统设计*
