# 第四章：角色系统设计

## 4.1 角色属性

### 基础属性
| 属性 | 缩写 | 说明 | 初始值 |
|------|------|------|--------|
| 生命值 | HP | 归零则死亡 | 100 |
| 攻击力 | ATK | 影响伤害输出 | 10 |
| 防御力 | DEF | 减少受到的伤害 | 5 |
| 移动速度 | SPD | 移动快慢 | 200 px/s |
| 暴击率 | CRIT | 触发暴击的概率 | 5% |
| 暴击伤害 | CRITDMG | 暴击时的伤害倍率 | 150% |

### 隐藏属性
| 属性 | 说明 | 初始值 |
|------|------|--------|
| 攻击速度 | 普攻间隔倍率 | 1.0x |
| 攻击范围 | 攻击判定范围倍率 | 1.0x |
| 冷却缩减 | 技能冷却减少比例 | 0% |
| 生命恢复 | 每秒恢复 HP | 0 |
| 吸血 | 造成伤害时恢复 HP | 0% |

### 属性上限
| 属性 | 上限 | 说明 |
|------|------|------|
| HP | 无 | 可无限叠加 |
| ATK | 无 | 可无限叠加 |
| DEF | 80% 减伤 | 防止无敌 |
| SPD | 500 px/s | 防止过快 |
| CRIT | 100% | 必定暴击 |
| CRITDMG | 500% | 防止秒杀 |
| 冷却缩减 | 75% | 保留技能间隔 |

## 4.2 成长机制

### 单局成长（Roguelike 强化）
```
成长来源：
┌─────────────────────────────────────────┐
│ 1. 波次结束奖励                         │
│    └─ 三选一强化道具                    │
│                                         │
│ 2. 击杀掉落                             │
│    └─ 小概率掉落临时增益                │
│                                         │
│ 3. 连击奖励                             │
│    └─ 高连击自动获得增益                │
└─────────────────────────────────────────┘
```

### 属性成长曲线（参考）
```
期望属性增长（相对初始值）：

波次    HP      ATK     其他
5      150%    130%    110%
10     200%    160%    120%
15     300%    200%    140%
20     450%    250%    160%
25+    指数增长...
```

## 4.3 技能池设计

### 技能分类
| 类别 | 特点 | 示例 |
|------|------|------|
| **输出型** | 高伤害，清怪为主 | 剑气横扫、剑域 |
| **机动型** | 位移、闪避 | 瞬步斩、御风步 |
| **防御型** | 减伤、护盾 | 护体真气 |
| **辅助型** | 增益、控制 | 减速、定身 |

### MVP 技能池（初始 5 技能）

已在第三章定义：
1. 剑斩（普攻）
2. 剑气横扫（Q - 范围）
3. 瞬步斩（E - 突进）
4. 护体真气（R - 防御）
5. 剑域（Space - 终极）
6. 御风步（Shift - 闪避）

### 扩展技能池（后续版本）

| 技能名 | 类型 | 效果描述 |
|--------|------|----------|
| 万剑归宗 | 输出 | 召唤剑雨，全屏伤害 |
| 剑心通明 | 辅助 | 短暂时间减缓，子弹时间 |
| 御剑飞行 | 机动 | 快速飞行穿越敌群 |
| 剑气护体 | 防御 | 被动护盾，定期刷新 |
| 破甲剑气 | 输出 | 穿透敌人，降低防御 |

## 4.4 角色状态

### 状态类型
| 状态 | 触发条件 | 视觉效果 |
|------|----------|----------|
| 普通 | 默认 | 正常显示 |
| 战斗中 | 近期有攻击/受击 | 边缘发光 |
| 受伤 | HP 低于 30% | 红色闪烁 |
| 无敌 | 闪避/技能期间 | 半透明 |
| 无双 | 连击 200+ | 金色光环 |
| 濒死 | HP 低于 10% | 强烈红色脉冲 |

### 状态机设计
```
状态转换图：

    ┌─────────┐
    │  普通   │←──────────────┐
    └────┬────┘              │
         │ 攻击/受击         │
         ↓                   │
    ┌─────────┐              │
    │ 战斗中  │──────────────┤ 5秒无动作
    └────┬────┘              │
         │ HP < 30%          │
         ↓                   │
    ┌─────────┐              │
    │  受伤   │──────────────┘
    └─────────┘       HP > 30%
```

## 4.5 角色数据结构

```javascript
// 角色数据模型
const PlayerData = {
  // 基础属性
  stats: {
    maxHp: 100,
    currentHp: 100,
    atk: 10,
    def: 5,
    spd: 200,
    critRate: 0.05,
    critDamage: 1.5
  },

  // 隐藏属性
  modifiers: {
    atkSpeed: 1.0,
    atkRange: 1.0,
    cooldownReduction: 0,
    hpRegen: 0,
    lifeSteal: 0
  },

  // 技能数据
  skills: {
    normalAttack: { cooldown: 0.3, damage: 1.0 },
    skill1: { cooldown: 4, damage: 1.5, currentCd: 0 },
    skill2: { cooldown: 5, damage: 2.0, currentCd: 0 },
    skill3: { cooldown: 8, damage: 1.0, currentCd: 0 },
    ultimate: { cooldown: 25, damage: 0.5, currentCd: 0 },
    dash: { cooldown: 1.5, currentCd: 0 }
  },

  // 状态
  state: {
    isInvincible: false,
    isInCombat: false,
    combo: 0,
    lastHitTime: 0
  },

  // Roguelike 强化
  buffs: []
};
```

---

*下一章：敌人系统设计*
